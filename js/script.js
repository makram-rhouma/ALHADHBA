
const I18N = {
  en: {
    brandName: "ALHADABA",
    brandSub: "Integrated Solutions Co. Ltd",
    nav: {
      about: "About",
      services: "Services",
      projects: "Projects",
      clients: "Clients",
      contact: "Contact",
    },
    hero: {
      kicker: "Construction & Contracting",
      title: "Integrated Solutions for Modern Projects",
      subtitle:
        "Engineering, renovation, concrete works, and project execution with quality, safety, and commitment.",
      ctaPrimary: "Request a Quote",
      ctaSecondary: "View Portfolio",
      metrics: {
        m1Value: "Quality",
        m1Label: "Standards",
        m2Value: "Safety",
        m2Label: "First",
        m3Value: "On-time",
        m3Label: "Delivery",
      },
      cardTitle: "Quick Contact",
      cardSub: "We respond within 24 hours.",
      phone: "Phone",
      phone2: "KSA",
      email: "Email",
    },
    about: {
      title: "About Us",
      subtitle: "A trusted partner for engineering and contracting solutions.",
      whoTitle: "Who we are",
      whoText:
        "Al Hadaba Integrated Solutions Co. Ltd is an engineering and contracting company delivering end-to-end solutions in construction, renovation, maintenance, and infrastructure works. We combine modern technologies with disciplined execution to achieve reliable results.",
      goalsTitle: "Company goals",
      goalsText:
        "Our priority is to exceed expectations, complete projects with high standards, and stay aligned with industry trends. We focus on quality control, innovation, and continuous improvement.",
      legalTitle: "Legal qualifications",
      legal1: "Registered with the Commercial Registrar.",
      legal2: "Registered for corporate taxes and holds a valid tax card.",
      legal3: "Registered with Zakat Office and Value Added Department.",
      legal4: "Member of the Federation of Chambers of Commerce and Contractors Union.",
      feature1Title: "Engineering Expertise",
      feature1Text: "Feasibility studies, cost estimation, architectural concepts, and construction designs.",
      feature2Title: "Execution & Supervision",
      feature2Text: "Detailed implementation programs, on-site supervision, and quality assurance.",
      feature3Title: "Maintenance & Infrastructure",
      feature3Text: "Periodic maintenance, roads, bridges, residential complexes, canals, and utility networks.",
    },
    services: {
      title: "Our Services",
      subtitle: "Comprehensive services designed for commercial, residential, and industrial projects.",
      s1Title: "Construction & Contracting",
      s1Text: "Full project execution, civil works, structures, and finishing packages.",
      s2Title: "Renovation & Rehabilitation",
      s2Text: "Upgrading, fit-out works, and rehabilitation for existing facilities.",
      s3Title: "Concrete & Structural Works",
      s3Text: "Concrete works, formwork, steel fixing, and structural solutions.",
      s4Title: "MEP Coordination",
      s4Text: "Electrical, mechanical, and plumbing coordination integrated with construction.",
      s5Title: "Engineering Studies",
      s5Text: "Feasibility studies, cost estimation, schedules, and quantities.",
      s6Title: "Maintenance & Infrastructure",
      s6Text: "Periodic maintenance, roads/bridges, canals, and networks connections.",
    },
    projects: {
      title: "Projects & Portfolio",
      subtitle: "Selected works from construction, fit-out, and partnered projects.",
      tab1: "Projects",
      tab2: "Partnered Projects",
    },
    clients: {
      title: "Strategic Clients & Partners",
      subtitle: "We’re proud to work with organizations that value quality and reliability.",
      c1: "King Abdullah Economic City (KAEC)",
      c2: "Al Mabani Contracting Co.",
      c3: "Almarai",
      c4: "SADAFCO",
      c5: "Dallah Al Mabani",
      c6: "Saudi Binladin Group",
      c7: "Safari Contracting Co.",
      c8: "Al Muhadib Contracting Co.",
    },
    contact: {
      title: "Contact",
      subtitle: "Tell us about your project. We’ll prepare a tailored solution.",
      infoTitle: "Company Information",
      addressLabel: "Address",
      addressValue: "Republic of Sudan – Khartoum, Al-Sahafa Street, Square 29, 2nd Floor",
      phoneLabel: "Phone",
      emailLabel: "Email",
      formTitle: "Send a message",
      name: "Full name",
      phone: "Phone",
      email: "Email",
      message: "Message",
      send: "Send",
    },
    footer: {
      copy: "©",
      company: "Al Hadaba Integrated Solutions Co. Ltd.",
      rights: "All rights reserved.",
      backTop: "Back to top",
    },
  },
  ar: {
    brandName: "الهضبة",
    brandSub: "شركة الحلول المهنية المتكاملة المحدودة",
    nav: {
      about: "من نحن",
      services: "خدماتنا",
      projects: "المشاريع",
      clients: "العملاء",
      contact: "تواصل معنا",
    },
    hero: {
      kicker: "الإنشاءات والمقاولات",
      title: "حلول متكاملة لمشاريع حديثة",
      subtitle: "هندسة، ترميم، أعمال خرسانية، وتنفيذ مشاريع بجودة وسلامة والتزام.",
      ctaPrimary: "اطلب عرض سعر",
      ctaSecondary: "شاهد الأعمال",
      metrics: {
        m1Value: "جودة",
        m1Label: "ومعايير",
        m2Value: "سلامة",
        m2Label: "أولاً",
        m3Value: "التزام",
        m3Label: "بالمواعيد",
      },
      cardTitle: "تواصل سريع",
      cardSub: "نرد خلال 24 ساعة.",
      phone: "هاتف",
      phone2: "السعودية",
      email: "البريد",
    },
    about: {
      title: "من نحن",
      subtitle: "شريك موثوق للحلول الهندسية والمقاولات.",
      whoTitle: "نبذة",
      whoText:
        "شركة الهضبة للحلول المتكاملة تقدم حلولاً شاملة في الإنشاءات، الترميم، الصيانة، وأعمال البنية التحتية. ندمج التقنيات الحديثة مع تنفيذ منضبط لتحقيق نتائج موثوقة.",
      goalsTitle: "أهداف الشركة",
      goalsText:
        "أولويتنا تجاوز التوقعات وإكمال المشاريع بأعلى المعايير ومواكبة تطورات القطاع. نركز على ضبط الجودة والابتكار والتحسين المستمر.",
      legalTitle: "المؤهلات القانونية",
      legal1: "مسجلة لدى السجل التجاري.",
      legal2: "مسجلة للضرائب وبطاقة ضريبية سارية.",
      legal3: "مسجلة لدى الزكاة وضريبة القيمة المضافة.",
      legal4: "عضو في اتحاد الغرف التجارية واتحاد المقاولين.",
      feature1Title: "خبرة هندسية",
      feature1Text: "دراسات جدوى، تقدير تكاليف، تصاميم معمارية وإنشائية.",
      feature2Title: "تنفيذ وإشراف",
      feature2Text: "برامج تنفيذ تفصيلية، إشراف ميداني، وضمان جودة.",
      feature3Title: "صيانة وبنية تحتية",
      feature3Text: "صيانة دورية، طرق وجسور، مجمعات سكنية، وقنوات وشبكات.",
    },
    services: {
      title: "خدماتنا",
      subtitle: "خدمات متكاملة للمشاريع التجارية والسكنية والصناعية.",
      s1Title: "إنشاءات ومقاولات",
      s1Text: "تنفيذ مشاريع كاملة وأعمال مدنية وهياكل وتشطيبات.",
      s2Title: "ترميم وإعادة تأهيل",
      s2Text: "تطوير وإعادة تأهيل وأعمال تشطيب للمرافق القائمة.",
      s3Title: "أعمال خرسانية وإنشائية",
      s3Text: "خرسانة، قوالب، تسليح، وحلول إنشائية.",
      s4Title: "تنسيق أعمال الكهرباء والميكانيكا",
      s4Text: "تنسيق أعمال الكهرباء والميكانيكا والسباكة ضمن التنفيذ.",
      s5Title: "دراسات هندسية",
      s5Text: "دراسات جدوى، تقدير تكاليف، جداول، وكميات.",
      s6Title: "صيانة وبنية تحتية",
      s6Text: "صيانة دورية، طرق/جسور، قنوات، وربط شبكات.",
    },
    projects: {
      title: "المشاريع والأعمال",
      subtitle: "نماذج مختارة من مشاريعنا وأعمال التشطيب والشراكات.",
      tab1: "مشاريع",
      tab2: "مشاريع بالشراكة",
    },
    clients: {
      title: "عملاء وشركاء استراتيجيون",
      subtitle: "نفخر بالعمل مع جهات تقدر الجودة والموثوقية.",
      c1: "مدينة الملك عبدالله الاقتصادية (KAEC)",
      c2: "شركة المباني للمقاولات",
      c3: "المراعي",
      c4: "سادافكو",
      c5: "دلة المباني",
      c6: "مجموعة بن لادن السعودية",
      c7: "سفاري للمقاولات",
      c8: "المهذب للمقاولات",
    },
    contact: {
      title: "تواصل معنا",
      subtitle: "أخبرنا عن مشروعك وسنقدم حلاً مناسباً.",
      infoTitle: "معلومات الشركة",
      addressLabel: "العنوان",
      addressValue: "جمهورية السودان – الخرطوم، شارع الصحافة، مربع 29، الطابق الثاني",
      phoneLabel: "الهاتف",
      emailLabel: "البريد الإلكتروني",
      formTitle: "أرسل رسالة",
      name: "الاسم الكامل",
      phone: "الهاتف",
      email: "البريد",
      message: "الرسالة",
      send: "إرسال",
    },
    footer: {
      copy: "©",
      company: "شركة الهضبة للحلول المتكاملة المحدودة.",
      rights: "جميع الحقوق محفوظة.",
      backTop: "العودة للأعلى",
    },
  },
};

const CHANTIER_IMAGES = Array.from({ length: 16 }, (_, idx) => {
  const n = idx + 1;
  return {
    src: `img/Chantier/Construction${n}.png`,
    title: { en: `Project Photo ${n}`, ar: `صورة مشروع ${n}` },
    sub: { en: "Site progress", ar: "تقدم الموقع" },
  };
});

const GALLERIES = {
  projects: [
    ...CHANTIER_IMAGES,
    {
      src: "img/ConstructionPhoto.jpg",
      title: { en: "Construction Work", ar: "أعمال إنشاءات" },
      sub: { en: "Execution & supervision", ar: "تنفيذ وإشراف" },
    },
  ],
};

const CLIENT_LOGOS = [
  { src: "img/CLient/Client1.png", alt: "Client 1" },
  { src: "img/CLient/Client2.png", alt: "Client 2" },
  { src: "img/CLient/Client3.png", alt: "Client 3" },
  { src: "img/CLient/Client4.png", alt: "Client 4" },
  { src: "img/CLient/Client5.png", alt: "Client 5" },
  { src: "img/CLient/Client6.png", alt: "Client 6" },
  { src: "img/CLient/Client7.png", alt: "Client 7" },
  { src: "img/CLient/Client8.png", alt: "Client 8" },
];

const GALLERY_PAGE_SIZE = 6;
let galleryPage = 0;

function currentLang() {
  return document.documentElement.lang === "ar" ? "ar" : "en";
}

function renderClients() {
  const root = document.getElementById("clientsGrid");
  if (!root) return;
  root.innerHTML = CLIENT_LOGOS.map((c) => {
    return `
      <div class="client-tile">
        <img class="client-logo" src="${c.src}" alt="${c.alt}" loading="lazy" />
      </div>
    `;
  }).join("");
}

function setupGalleryPager() {
  const pager = document.getElementById("galleryPager");
  if (!pager) return;

  function go(page) {
    const p = Number(page);
    if (Number.isNaN(p)) return;
    galleryPage = p;
    renderGallery("projects", currentLang());
  }

  pager.addEventListener("click", (e) => {
    const btn = e.target.closest("[data-page]");
    if (!btn) return;
    go(btn.getAttribute("data-page"));
  });

  pager.addEventListener("keydown", (e) => {
    const btn = e.target.closest("[data-page]");
    if (!btn) return;
    if (e.key === "Enter" || e.key === " ") {
      e.preventDefault();
      go(btn.getAttribute("data-page"));
    }
  });
}

function setupBackToTopFloat() {
  const btn = document.getElementById("backTopFloat");
  if (!btn) return;

  let ticking = false;

  function update() {
    ticking = false;
    const y = window.scrollY || document.documentElement.scrollTop || 0;
    btn.classList.toggle("is-visible", y > 420);
  }

  function onScroll() {
    if (ticking) return;
    ticking = true;
    requestAnimationFrame(update);
  }

  window.addEventListener("scroll", onScroll, { passive: true });
  update();

  btn.addEventListener("click", (e) => {
    e.preventDefault();
    window.scrollTo({ top: 0, behavior: "smooth" });
  });
}

function getNested(obj, path) {
  return path.split(".").reduce((acc, key) => (acc && acc[key] != null ? acc[key] : null), obj);
}

function setLanguage(lang) {
  const html = document.documentElement;
  const dict = I18N[lang] || I18N.en;

  html.lang = lang;
  html.dir = lang === "ar" ? "rtl" : "ltr";

  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    const value = getNested(dict, key);
    if (typeof value === "string") el.textContent = value;
  });

  document.querySelectorAll(".lang-pill").forEach((pill) => {
    const isActive = pill.getAttribute("data-lang") === lang;
    pill.classList.toggle("is-active", isActive);
  });

  galleryPage = 0;
  renderGallery("projects", lang);
  localStorage.setItem("lang", lang);
}

function setupMobileNav() {
  const toggle = document.querySelector(".nav-toggle");
  const nav = document.querySelector(".site-nav");
  const links = document.querySelectorAll(".nav-link");
  if (!toggle || !nav) return;

  function close() {
    nav.classList.remove("is-open");
    toggle.setAttribute("aria-expanded", "false");
  }

  toggle.addEventListener("click", () => {
    const isOpen = nav.classList.toggle("is-open");
    toggle.setAttribute("aria-expanded", String(isOpen));
  });

  links.forEach((a) => a.addEventListener("click", close));
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") close();
  });
}

function setupSmoothScroll() {
  document.querySelectorAll('a[href^="#"]').forEach((a) => {
    a.addEventListener("click", (e) => {
      const href = a.getAttribute("href");
      if (!href || href === "#") return;
      const target = document.querySelector(href);
      if (!target) return;
      e.preventDefault();

      if (href === "#top") {
        window.scrollTo({ top: 0, behavior: "smooth" });
      } else {
        target.scrollIntoView({ behavior: "smooth", block: "start" });
      }

      try {
        history.pushState(null, "", href);
      } catch {
        try {
          window.location.hash = href;
        } catch {
          // ignore
        }
      }
    });
  });
}

function setupRevealOnScroll() {
  const items = document.querySelectorAll("[data-reveal]");
  if (!items.length) return;

  const io = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("is-visible");
          io.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.12 }
  );

  items.forEach((el) => io.observe(el));
}

function renderGallery(type, lang) {
  const data = GALLERIES[type] || [];
  const root = document.getElementById("galleryProjects");
  const pager = document.getElementById("galleryPager");
  if (!root) return;

  const totalPages = Math.max(1, Math.ceil(data.length / GALLERY_PAGE_SIZE));
  const safePage = Math.max(0, Math.min(galleryPage, totalPages - 1));
  galleryPage = safePage;
  const start = safePage * GALLERY_PAGE_SIZE;
  const slice = data.slice(start, start + GALLERY_PAGE_SIZE);

  root.innerHTML = slice
    .map((item, localIdx) => {
      const idx = start + localIdx;
      const title = item.title?.[lang] || item.title?.en || "";
      const sub = item.sub?.[lang] || item.sub?.en || "";
      return `
        <div class="gallery-item" role="button" tabindex="0" data-gallery-item data-type="${type}" data-index="${idx}">
          <img src="${item.src}" alt="${title}" loading="lazy" />
          <div class="gallery-meta">
            <p class="gallery-title">${title}</p>
            <p class="gallery-sub">${sub}</p>
          </div>
        </div>
      `;
    })
    .join("");

  if (pager) {
    pager.innerHTML = Array.from({ length: totalPages }, (_, i) => {
      const isActive = i === safePage;
      return `
        <button class="pager-dot${isActive ? " is-active" : ""}" type="button" aria-label="Page ${i + 1}" ${isActive ? 'aria-current="true"' : ""} data-page="${i}"></button>
      `;
    }).join("");
  }
}

function setupLightbox() {
  const lb = document.getElementById("lightbox");
  const img = document.getElementById("lightboxImg");
  const titleEl = document.getElementById("lightboxTitle");
  const subEl = document.getElementById("lightboxSub");
  if (!lb || !img || !titleEl || !subEl) return;

  let state = { type: "projects", index: 0 };

  function currentLang() {
    return document.documentElement.lang === "ar" ? "ar" : "en";
  }

  function open(type, index) {
    const safeType = "projects";
    const data = GALLERIES[safeType] || [];
    if (!data.length) return;
    state = { type: safeType, index: Math.max(0, Math.min(index, data.length - 1)) };
    const item = data[state.index];
    const lang = currentLang();
    const title = item.title?.[lang] || item.title?.en || "";
    const sub = item.sub?.[lang] || item.sub?.en || "";

    img.src = item.src;
    img.alt = title;
    titleEl.textContent = title;
    subEl.textContent = sub;
    lb.classList.add("is-open");
    lb.setAttribute("aria-hidden", "false");
    document.body.style.overflow = "hidden";
  }

  function close() {
    lb.classList.remove("is-open");
    lb.setAttribute("aria-hidden", "true");
    document.body.style.overflow = "";
    img.src = "";
  }

  function step(delta) {
    const data = GALLERIES[state.type] || [];
    if (!data.length) return;
    const next = (state.index + delta + data.length) % data.length;
    open(state.type, next);
  }

  document.addEventListener("click", (e) => {
    const item = e.target.closest("[data-gallery-item]");
    if (item) {
      const type = "projects";
      const index = Number(item.getAttribute("data-index") || 0);
      open(type, index);
      return;
    }

    const closeBtn = e.target.closest("[data-close]");
    if (closeBtn) close();

    const prevBtn = e.target.closest("[data-prev]");
    if (prevBtn) step(-1);

    const nextBtn = e.target.closest("[data-next]");
    if (nextBtn) step(1);
  });

  document.addEventListener("keydown", (e) => {
    if (!lb.classList.contains("is-open")) return;
    if (e.key === "Escape") close();
    if (e.key === "ArrowLeft") step(document.documentElement.dir === "rtl" ? 1 : -1);
    if (e.key === "ArrowRight") step(document.documentElement.dir === "rtl" ? -1 : 1);
  });

  document.addEventListener("keydown", (e) => {
    if (e.key !== "Enter" && e.key !== " ") return;
    const active = document.activeElement;
    if (!active) return;
    if (active.matches("[data-gallery-item]")) {
      e.preventDefault();
      const type = active.getAttribute("data-type") || "projects";
      const index = Number(active.getAttribute("data-index") || 0);
      open(type, index);
    }
  });
}

function setupLanguageSwitcher() {
  const btn = document.querySelector(".lang-switch");
  if (!btn) return;
  btn.addEventListener("click", (e) => {
    const pill = e.target.closest(".lang-pill");
    if (!pill) return;
    const lang = pill.getAttribute("data-lang");
    if (!lang) return;
    setLanguage(lang);
  });
}

function setYear() {
  const year = document.getElementById("year");
  if (year) year.textContent = String(new Date().getFullYear());
}

function boot() {
  setYear();
  renderClients();
  setupMobileNav();
  setupSmoothScroll();
  setupRevealOnScroll();
  setupGalleryPager();
  setupLightbox();
  setupLanguageSwitcher();
  setupBackToTopFloat();

  const saved = localStorage.getItem("lang");
  const initial = saved === "ar" ? "ar" : "en";
  setLanguage(initial);

  requestAnimationFrame(() => document.body.classList.add("is-loaded"));
}

document.addEventListener("DOMContentLoaded", boot);
